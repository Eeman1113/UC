<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulcerative Colitis: A Comprehensive Infographic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Calmer Green-Accented, Notion/Shadcn Inspired Aesthetic */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF; /* White background */
            color: #334155; /* Slate 700 for body text */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.7; /* Increased for readability */
        }

        .main-content-area {
            max-width: 768px; /* Slightly wider for modern feel, still readable */
            margin: 0 auto;
            padding: 4rem 2rem; /* Generous vertical padding */
        }

        .content-section {
            margin-bottom: 3.5rem; /* Consistent space between sections */
            padding-bottom: 3.5rem;
            border-bottom: 1px solid #E2E8F0; /* Slate 200 for subtle divider */
        }

        .content-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 480px; /* Adjusted for content flow */
            margin: 2rem auto; /* Increased margin */
            height: 280px;
            max-height: 350px;
        }

        h1 { /* Main Page Title */
            color: #0F172A; /* Slate 900 */
            font-weight: 600; /* Slightly less heavy */
            font-size: 2.25rem; /* More Notion-like */
            line-height: 1.25;
            letter-spacing: -0.025em;
            margin-bottom: 1rem;
            text-align: center;
        }

        h2 { /* Section Titles */
            color: #059669; /* Emerald 600 - Calmer Green Accent */
            font-weight: 600;
            font-size: 1.5rem;
            line-height: 1.3;
            margin-bottom: 1.75rem; /* Increased margin */
            letter-spacing: -0.01em;
        }

        h3 { /* Sub-section Titles / Card-like Titles */
            color: #1E293B; /* Slate 800 */
            font-weight: 600;
            font-size: 1.25rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }

        h4 { /* Smaller headings */
            color: #334155; /* Slate 700 */
            font-weight: 500;
            font-size: 1rem;
            margin-bottom: 0.625rem;
        }

        .highlight-stat { /* Large number display */
            color: #10B981; /* Emerald 500 */
            font-weight: 700;
            font-size: 3rem; /* Made larger for impact */
            line-height: 1;
            display: block;
            margin: 0.75rem 0;
        }

        .page-subtitle {
            color: #64748B; /* Slate 500 */
            font-size: 1.125rem;
            line-height: 1.6;
            margin-bottom: 3.5rem; /* Increased space */
            text-align: center;
            max-width: 640px;
            margin-left: auto;
            margin-right: auto;
        }

        .text-block { /* General paragraph text */
            color: #475569; /* Slate 600 */
            font-size: 1rem; /* Standardized to 1rem */
            margin-bottom: 1.25rem;
        }

        .visualization-context-text { /* Text explaining charts/diagrams */
            color: #64748B; /* Slate 500 */
            font-size: 0.875rem; /* Slightly larger for readability */
            line-height: 1.5;
            margin-top: 0.75rem;
            text-align: center;
        }

        .diagram-item { /* For text-based diagrams like flowchart steps */
            background-color: #F8FAFC; /* Slate 50 */
            border: 1px solid #E2E8F0; /* Slate 200 */
            color: #334155; /* Slate 700 */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem; /* md */
            text-align: center;
            font-weight: 500;
            font-size: 0.875rem;
            margin-bottom: 0.625rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.03);
        }
        /* Specific diagram item for UC development - warning color */
        .diagram-item.uc-development-warning {
            border-color: #F43F5E; /* Rose 500 */
            background-color: #FFF1F2; /* Rose 50 */
            color: #BE123C; /* Rose 700 */
        }

        .diagram-arrow {
            font-size: 1.25rem;
            color: #CBD5E1; /* Slate 300 */
            margin: 0.375rem 0;
            text-align: center;
        }

        .gemini-feature-section {
            background-color: #F8FAFC; /* Slate 50 */
            border: 1px solid #E2E8F0; /* Slate 200 */
            border-radius: 0.75rem; /* lg */
            padding: 2rem; /* Increased padding */
            margin-top: 2.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
        }

        .gemini-input {
            border: 1px solid #CBD5E1; /* Slate 300 */
            border-radius: 0.375rem; /* md */
            padding: 0.625rem 0.875rem;
            width: 100%;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            color: #334155; /* Slate 700 */
            background-color: #FFFFFF;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .gemini-input:focus {
            outline: none;
            border-color: #10B981; /* Emerald 500 */
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); /* Emerald 500 with opacity */
        }

        .gemini-button {
            background-color: #10B981; /* Emerald 500 */
            color: #FFFFFF;
            padding: 0.625rem 1.25rem; /* Adjusted padding */
            border-radius: 0.375rem; /* md */
            font-weight: 500;
            font-size: 0.95rem;
            transition: background-color 0.2s ease-in-out;
            width: 100%;
            border: none; /* Remove default border */
        }

        .gemini-button:hover {
            background-color: #059669; /* Emerald 600 */
        }
        .gemini-button:disabled, .gemini-button.opacity-75 {
            background-color: #A7F3D0; /* Lighter Emerald for disabled state */
            cursor: not-allowed;
            opacity: 0.75;
        }


        .gemini-output {
            margin-top: 1.25rem;
            padding: 1rem;
            background-color: #FFFFFF;
            border-radius: 0.375rem; /* md */
            border: 1px solid #E2E8F0; /* Slate 200 */
            min-height: 40px;
            white-space: pre-wrap;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #475569; /* Slate 600 */
        }

        .loading-spinner {
            border: 3px solid #E2E8F0; /* Slate 200 */
            border-top: 3px solid #10B981; /* Emerald 500 */
            border-radius: 50%;
            width: 24px; /* Slightly larger */
            height: 24px;
            animation: spin 0.8s linear infinite;
            margin: 1.5rem auto; /* Centered with more space */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .disclaimer-text {
            font-size: 0.8rem; /* Smaller */
            color: #EF4444; /* Red 500 for standard warning - kept for visibility */
            margin-top: 1rem;
            text-align: center;
            font-weight: 400;
        }

        .list-disc {
            padding-left: 1.5rem; /* Increased indent */
            font-size: 0.95rem; /* Consistent with inputs */
            list-style-type: disc;
        }

        .list-disc > li {
            margin-bottom: 0.5rem; /* More space between items */
            color: #475569; /* Slate 600 */
        }

        .list-disc > li::marker {
            color: #10B981; /* Emerald 500 marker */
        }

        .footer-text {
            font-size: 0.875rem;
            color: #94A3B8; /* Slate 400 for footer */
            text-align: center;
            padding-top: 3rem; /* More space before footer */
        }

        .citation {
            font-size: 0.75rem; /* Slightly larger */
            color: #94A3B8; /* Slate 400 */
        }

        /* Styles for specific medication category diagram items */
        .med-category-item { /* Base style for medication categories */
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            border-radius: 0.375rem;
            text-align: left;
            color: #1E293B; /* Slate 800 for text */
        }
        .med-cat-small-mol { background-color: #F0FDFA; border: 1px solid #A7F3D0; color: #065F46;} /* Emerald 50 bg, Emerald 200 border, Emerald 800 text */
        .med-cat-biologic { background-color: #EFF6FF; border: 1px solid #BAE6FD; color: #1E40AF;} /* Blue 50 bg, Blue 200 border, Blue 800 text */
        .med-cat-immunomod { background-color: #FFFBEB; border: 1px solid #FDE68A; color: #92400E;} /* Amber 50 bg, Amber 200 border, Amber 800 text */
        .med-cat-corticosteroid { background-color: #FFF1F2; border: 1px solid #FECDD3; color: #9F1239;} /* Rose 50 bg, Rose 200 border, Rose 800 text */
        .med-cat-aminosalicylate { background-color: #F8FAFC; border: 1px solid #E2E8F0; color: #334155;} /* Slate 50 bg, Slate 200 border, Slate 700 text */

    </style>
</head>
<body>

<div class="main-content-area">

    <header class="mb-16"> <h1>Navigating Ulcerative Colitis</h1>
        <p class="page-subtitle">A Comprehensive Infographic on Understanding and Managing the Condition</p>
    </header>

    <section id="overview" class="content-section">
        <h2>Ulcerative Colitis: An Overview</h2>
        <p class="text-block">Ulcerative colitis (UC) is a chronic inflammatory bowel disease (IBD) affecting the large intestine. It causes inflammation and ulcers in the colon and rectum, leading to various symptoms and requiring long-term management.</p>
        <div class="text-center my-8"> <p class="text-block text-base">Estimated Number of People Affected in the United States:</p> <span class="highlight-stat">~1 Million</span>
            <p class="visualization-context-text mt-2">This highlights the significant prevalence of UC. <span class="citation">[1]</span></p>
        </div>
    </section>

    <section id="understanding" class="content-section">
        <h2>Understanding the Condition</h2>
        <p class="text-block">UC is classified by the location and extent of inflammation. Understanding the type helps tailor treatment and predict potential complications.</p>

        <div>
            <h3>Types of Ulcerative Colitis</h3>
            <p class="visualization-context-text mb-3">UC primarily affects the innermost lining of the large intestine.</p>
            <ul class="list-disc space-y-1.5 mb-6"> <li><strong>Ulcerative Proctitis:</strong> Inflammation confined to the rectum. <span class="citation">[1, 6]</span></li>
                <li><strong>Left-Sided Colitis:</strong> Inflammation extends from the rectum up the left side of the colon. <span class="citation">[1, 6]</span></li>
                <li><strong>Extensive Colitis (Pancolitis):</strong> Inflammation affects the entire colon. <span class="citation">[1, 6]</span></li>
            </ul>
            <div class="mt-4 p-4 border border-slate-200 rounded-lg bg-slate-50 shadow-sm"> <h4 class="text-center text-sm font-medium text-emerald-700 mb-3">Affected Colon Regions (Simplified)</h4>
                <div class="space-y-2 text-xs">
                    <div class="diagram-item"><strong>Proctitis:</strong> Rectum Only</div>
                    <div class="diagram-item"><strong>Left-Sided:</strong> Rectum, Sigmoid, Descending Colon</div>
                    <div class="diagram-item"><strong>Extensive/Pancolitis:</strong> Entire Colon</div>
                </div>
            </div>
        </div>

        <div class="mt-10"> <h3>Who is at Risk?</h3>
            <div class="chart-container">
                <canvas id="riskFactorAgeChart"></canvas>
            </div>
            <p class="visualization-context-text">Diagnosis commonly occurs before age 30. <span class="citation">[1, 2, 4]</span></p>
            <ul class="list-disc space-y-1.5 text-sm mt-4"> <li><strong>Ethnicity:</strong> More common in white individuals. <span class="citation">[1, 10]</span></li>
                <li><strong>Family History:</strong> A first-degree relative with UC increases risk. <span class="citation">[1, 4, 11]</span></li>
            </ul>
        </div>

        <div class="mt-10"> <h3>Prevalence of Ulcerative Proctitis</h3>
            <div class="chart-container">
                <canvas id="proctitisPrevalenceChart"></canvas>
            </div>
            <p class="visualization-context-text">Approximately one-third of all UC cases start as ulcerative proctitis. <span class="citation">[6]</span></p>
        </div>
    </section>

    <section id="causes" class="content-section">
        <h2>The Science Behind UC: Why Does it Happen?</h2>
        <p class="text-block">The exact cause of UC is unknown, but it's believed to result from a complex interaction of an overactive immune system, genetic predisposition, an imbalanced gut microbiome, and environmental factors. <span class="citation">[2, 4, 12]</span></p>
        <div>
            <h3 class="mb-3">Key Contributing Factors:</h3>
            <ul class="list-disc space-y-2 text-sm"> <li><strong>Overactive Immune System.</strong> <span class="citation">[1, 13]</span></li>
                <li><strong>Genetic Links.</strong> <span class="citation">[3, 10, 11]</span></li>
                <li><strong>Gut Microbiome Imbalance (Dysbiosis).</strong> <span class="citation">[2, 12]</span></li>
                <li><strong>Environmental Triggers.</strong> <span class="citation">[1, 3, 14, 22]</span></li>
            </ul>
        </div>
        <div class="mt-6 p-4 border border-slate-200 rounded-lg bg-slate-50 shadow-sm"> <h4 class="text-center text-sm font-medium text-emerald-700 mb-3">Conceptual Interplay of Factors</h4>
            <div class="flex flex-col items-center space-y-1.5">
                <div class="diagram-item w-full max-w-sm">Genetics</div>
                <div class="diagram-arrow">↓</div>
                <div class="diagram-item w-full max-w-sm">Immune System Dysregulation</div>
                <div class="diagram-arrow">↓</div>
                <div class="flex space-x-2 w-full max-w-sm">
                    <div class="diagram-item flex-1">Microbiome</div>
                    <div class="diagram-item flex-1">Environment</div>
                </div>
                <div class="diagram-arrow">↓</div>
                <div class="diagram-item uc-development-warning w-full max-w-sm">Ulcerative Colitis Development</div>
            </div>
        </div>
    </section>

    <section id="symptoms" class="content-section">
        <h2>Recognizing the Signs: Symptoms of UC</h2>
        <p class="text-block">UC symptoms vary depending on the severity and location of inflammation.</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8"> <div>
                <h3>Common Intestinal Symptoms <span class="citation">[1, 12, 25]</span></h3>
                <ul class="list-disc space-y-1.5">
                    <li>Diarrhea (often with blood/pus)</li>
                    <li>Rectal bleeding</li>
                    <li>Abdominal pain & cramping</li>
                    <li>Rectal pain & Urgency</li>
                </ul>
            </div>
            <div>
                <h3>General Well-being Symptoms <span class="citation">[1, 12, 25]</span></h3>
                <ul class="list-disc space-y-1.5">
                    <li>Fatigue</li>
                    <li>Weight loss & loss of appetite</li>
                    <li>Fever & Anemia</li>
                </ul>
            </div>
        </div>
        <div class="mt-8"> <h3 class="text-center">Extraintestinal Manifestations (EIMs)</h3>
            <p class="visualization-context-text mb-3">UC can affect other parts of the body. <span class="citation">[3, 29, 30, 31]</span></p>
            <div class="chart-container">
                <canvas id="eimPrevalenceChart"></canvas>
            </div>
            <p class="visualization-context-text mt-2">Arthritis is the most frequent EIM. <span class="citation">[30, 31, 32]</span></p>
        </div>
    </section>

    <section id="diagnosis" class="content-section">
        <h2>The Path to Diagnosis</h2>
        <p class="text-block">Diagnosing UC involves multiple steps to confirm inflammation and rule out other conditions. <span class="citation">[1, 41, 42, 43]</span></p>
        <h3 class="mb-3">Key Diagnostic Steps:</h3>
        <div class="space-y-2.5"> <div class="diagram-item">Medical History & Physical Exam</div>
            <div class="diagram-arrow text-center">↓</div>
            <div class="diagram-item">Blood Tests & Stool Analysis</div>
            <div class="diagram-arrow text-center">↓</div>
            <div class="diagram-item">Endoscopy (Colonoscopy/Sigmoidoscopy)</div>
            <div class="diagram-arrow text-center">↓</div>
            <div class="diagram-item" style="border-color: #10B981; background-color: #ECFDF5; color: #065F46;">Biopsy & Confirmation</div> </div>
        <p class="visualization-context-text mt-3">Endoscopy with biopsy is the gold standard. <span class="citation">[1, 43, 48]</span></p>
    </section>

    <section id="treatment" class="content-section">
        <h2>Treatment Landscape for UC</h2>
        <p class="text-block">Treatment aims to induce and maintain remission, improve quality of life, and prevent complications. <span class="citation">[5, 51, 52, 53, 54]</span></p>

        <div>
            <h3 class="mb-3">Medication Categories</h3>
            <div class="space-y-2 text-xs">
                <div class="diagram-item med-category-item med-cat-small-mol">Small Molecules (JAK Inhibitors, S1P Modulators)</div>
                <div class="diagram-item med-category-item med-cat-biologic">Biologic Therapies</div>
                <div class="diagram-item med-category-item med-cat-immunomod">Immunomodulators</div>
                <div class="diagram-item med-category-item med-cat-corticosteroid">Corticosteroids (For Flares)</div>
                <div class="diagram-item med-category-item med-cat-aminosalicylate">Aminosalicylates (5-ASAs)</div>
            </div>
            <p class="visualization-context-text mt-2">Medication choice depends on severity and location. <span class="citation">[43, 50, 70]</span></p>
        </div>

        <div class="mt-8"> <h3 class="text-center">Corticosteroid Efficacy & Challenges</h3>
            <div class="chart-container">
                <canvas id="steroidEfficacyChart"></canvas>
            </div>
            <p class="visualization-context-text mt-2">Effective for flares but not for long-term use. <span class="citation">[61, 62, 64]</span></p>
        </div>

        <div class="gemini-feature-section">
            <h3 class="text-center mb-2">✨ Ask Your Doctor: Question Generator</h3>
            <p class="visualization-context-text text-center mb-4">Prepare for your doctor's appointment.</p>
            <input type="text" id="doctorQuestionTopic" class="gemini-input" placeholder="E.g., 'Side effects of medication'">
            <button id="generateDoctorQuestionsBtn" class="gemini-button">Generate Questions</button>
            <div id="doctorQuestionsLoader" class="hidden loading-spinner"></div>
            <div id="doctorQuestionsOutput" class="gemini-output mt-4 hidden"></div>
            <p class="disclaimer-text">This tool provides general question suggestions, not medical advice.</p>
        </div>

        <div class="mt-10"> <h3 class="text-center">Surgical Options</h3>
            <p class="visualization-context-text mb-1">Surgery may be needed for 1/4 to 1/3 of UC patients. <span class="citation">[43, 51, 88]</span></p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mt-4 text-sm">
                <div>
                    <h4 class="text-emerald-700">When is Surgery Considered? <span class="citation">[43, 85]</span></h4>
                    <ul class="list-disc">
                        <li>Life-threatening complications</li>
                        <li>Failure of medical therapy</li>
                        <li>Cancer or high-grade dysplasia</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-emerald-700">Common Surgical Procedures:</h4>
                    <ul class="list-disc">
                        <li>IPAA (J-Pouch) <span class="citation">[88, 90]</span></li>
                        <li>Proctocolectomy with End Ileostomy <span class="citation">[50, 86]</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section id="living" class="content-section">
        <h2>Living with UC: Diet & Lifestyle</h2>
        <p class="text-block">Diet and lifestyle play key roles in symptom management and overall well-being. <span class="citation">[1, 22, 99, 114]</span></p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8"> <div>
                <h3>Dietary Guidance <span class="citation">[99, 101]</span></h3>
                <h4 class="text-emerald-700 mt-3">During Remission:</h4>
                <ul class="list-disc text-sm"><li>Balanced, nutrient-rich diet.</li></ul>
                <h4 class="text-red-700 mt-2">During Flares:</h4>
                <ul class="list-disc text-sm"><li>Low-fiber/low-residue, soft, bland foods.</li></ul>
            </div>
            <div>
                <h3>Lifestyle & Self-Care</h3>
                <ul class="list-disc space-y-1.5">
                    <li>Stress Management <span class="citation">[1, 114, 116]</span></li>
                    <li>Regular Exercise <span class="citation">[115, 120]</span></li>
                    <li>Adequate Sleep & Medication Adherence</li>
                </ul>
            </div>
        </div>

        <div class="gemini-feature-section">
            <h3 class="text-center mb-2">✨ Personalized Diet Ideas</h3>
            <p class="visualization-context-text text-center mb-4">Get general meal ideas. Not a prescribed diet plan.</p>
            <textarea id="dietPreferences" class="gemini-input h-24" placeholder="E.g., 'Low-lactose breakfast ideas'"></textarea>
            <button id="generateDietIdeasBtn" class="gemini-button">Get Diet Ideas</button>
            <div id="dietIdeasLoader" class="hidden loading-spinner"></div>
            <div id="dietIdeasOutput" class="gemini-output mt-4 hidden"></div>
            <p class="disclaimer-text">General dietary suggestions, not medical advice. Consult a professional.</p>
        </div>

        <div class="mt-10"> <h3 class="text-center">Nutritional Supplements</h3>
            <p class="visualization-context-text mb-3">Deficiencies are common. Consult your doctor. <span class="citation">[17, 84, 106]</span></p>
            <div class="chart-container">
                <canvas id="commonDeficienciesChart"></canvas>
            </div>
            <p class="visualization-context-text mt-2">Iron deficiency is very common. <span class="citation">[17, 84]</span></p>
        </div>
    </section>

    <footer class="footer-text">
        <p>This infographic provides general information and is not a substitute for professional medical advice. Always consult with a qualified healthcare provider.</p>
        <p class="mt-2">AI-generated content is for informational purposes only.</p>
    </footer>

</div>

<script>
    Chart.defaults.font.family = 'Inter';
    Chart.defaults.color = '#64748B'; // Slate 500 for chart text

    // Calmer Emerald-Accented Chart Palette
    const CALM_CHART_COLORS = {
        primaryAccentDark: '#047857',    // Emerald 700
        primaryAccentMedium: '#10B981', // Emerald 500
        primaryAccentLight: '#34D399',  // Emerald 400
        accentLighter: '#A7F3D0',    // Emerald 200
        neutralBase: '#FFFFFF',       // White for backgrounds in mixed charts if needed
        neutralLight: '#F8FAFC',      // Slate 50
        neutralMedium: '#94A3B8',     // Slate 400 (for grid lines, secondary text)
        textDark: '#334155'         // Slate 700
    };

    function wrapLabel(str, maxWidth) {
        if (!str) return '';
        if (Array.isArray(str)) return str; // Already wrapped
        const strToString = String(str);
        if (strToString.length <= maxWidth) return strToString;

        const words = strToString.split(' ');
        let currentLine = '';
        const lines = [];
        for (const word of words) {
            if ((currentLine + word).length <= maxWidth || currentLine.length === 0) {
                currentLine += word + ' ';
            } else {
                lines.push(currentLine.trim());
                currentLine = word + ' ';
            }
        }
        lines.push(currentLine.trim());
        return lines.filter(line => line.length > 0);
    }

    const tooltipTitleCallback = function(tooltipItems) {
        const item = tooltipItems[0];
        let label = item.chart.data.labels[item.dataIndex];
        if (Array.isArray(label)) return label.join(' '); // Join wrapped lines
        return String(label);
    };

    const commonChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: { size: 10, family: 'Inter' },
                    color: CALM_CHART_COLORS.neutralMedium,
                    boxWidth: 12,
                    padding: 15
                }
            },
            tooltip: {
                callbacks: { title: tooltipTitleCallback },
                titleFont: { family: 'Inter', weight: '600', size: 12 },
                bodyFont: { family: 'Inter', size: 11 },
                backgroundColor: 'rgba(15, 23, 42, 0.85)', // Slate 900 with opacity
                titleColor: '#FFFFFF',
                bodyColor: '#E2E8F0', // Slate 200
                padding: 10,
                cornerRadius: 4,
                borderColor: 'rgba(255,255,255,0.1)',
                borderWidth: 1
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: { font: { size: 9, family: 'Inter' }, color: CALM_CHART_COLORS.neutralMedium },
                grid: { color: '#E2E8F0' } // Slate 200
            },
            x: {
                ticks: {
                    font: { size: 9, family: 'Inter' },
                    color: CALM_CHART_COLORS.neutralMedium,
                    callback: function(value, index, values) {
                        const label = this.getLabelForValue(value);
                        return wrapLabel(label, 10);
                    }
                },
                grid: { display: false }
            }
        }
    };

    // Chart initializations
    if (document.getElementById('riskFactorAgeChart')) {
        new Chart(document.getElementById('riskFactorAgeChart'), {
            type: 'bar',
            data: {
                labels: ['15-30 years', 'Mid-30s', wrapLabel('>60 years', 10)],
                datasets: [{
                    label: 'Age of Onset',
                    data: [60, 25, 15],
                    backgroundColor: [CALM_CHART_COLORS.primaryAccentMedium, CALM_CHART_COLORS.primaryAccentLight, CALM_CHART_COLORS.accentLighter],
                    borderWidth: 0,
                    borderRadius: 3,
                    barPercentage: 0.7,
                    categoryPercentage: 0.7
                }]
            },
            options: { ...commonChartOptions, indexAxis: 'y', plugins: {...commonChartOptions.plugins, legend: {display: false}} }
        });
    }

    if (document.getElementById('proctitisPrevalenceChart')) {
        new Chart(document.getElementById('proctitisPrevalenceChart'), {
            type: 'doughnut',
            data: {
                labels: ['Ulcerative Proctitis', 'Other UC Types'],
                datasets: [{
                    label: 'Prevalence',
                    data: [33, 67],
                    backgroundColor: [CALM_CHART_COLORS.primaryAccentMedium, CALM_CHART_COLORS.neutralLight],
                    borderColor: CALM_CHART_COLORS.neutralBase,
                    borderWidth: 3,
                    hoverOffset: 4
                }]
            },
            options: { ...commonChartOptions, cutout: '70%' }
        });
    }

    if (document.getElementById('eimPrevalenceChart')) {
        new Chart(document.getElementById('eimPrevalenceChart'), {
            type: 'bar',
            data: {
                labels: [wrapLabel('Arthritis',10), wrapLabel('Skin Issues',10), wrapLabel('Eye Issues',10), wrapLabel('PSC (Liver)',10)],
                datasets: [{
                    label: 'Approx. Prevalence (%)',
                    data: [40, 20, 12, 7],
                    backgroundColor: CALM_CHART_COLORS.primaryAccentMedium,
                    borderRadius: 3,
                    borderWidth: 0,
                    barPercentage: 0.6,
                    categoryPercentage: 0.6
                }]
            },
            options: { ...commonChartOptions,
                scales: { ...commonChartOptions.scales, x: { ...commonChartOptions.scales.x, ticks: { autoSkip: false, maxRotation: 0, minRotation: 0 }}},
                plugins: {...commonChartOptions.plugins, legend: {display: true, position: 'top', labels: {...commonChartOptions.plugins.legend.labels, font: {size: 9}}}}
            }
        });
    }

    if (document.getElementById('steroidEfficacyChart')) {
        new Chart(document.getElementById('steroidEfficacyChart'), {
            type: 'pie',
            data: {
                labels: [wrapLabel('Complete Remission',12), wrapLabel('Partial Remission',12), wrapLabel('Steroid-Refractory',12), wrapLabel('Steroid-Dependent',12)],
                datasets: [{
                    data: [54, 16, 18, 12],
                    backgroundColor: [CALM_CHART_COLORS.primaryAccentDark, CALM_CHART_COLORS.primaryAccentMedium, CALM_CHART_COLORS.primaryAccentLight, CALM_CHART_COLORS.accentLighter],
                    borderColor: CALM_CHART_COLORS.neutralBase,
                    borderWidth: 3,
                    hoverOffset: 4
                }]
            },
            options: { ...commonChartOptions }
        });
    }

    if (document.getElementById('commonDeficienciesChart')) {
        new Chart(document.getElementById('commonDeficienciesChart'), {
            type: 'bar',
            data: {
                labels: [wrapLabel('Iron Deficiency',12), wrapLabel('Vitamin D',10), wrapLabel('Vitamin B12',10), wrapLabel('Calcium',10)],
                datasets: [{
                    label: 'Estimated Prevalence (%)',
                    data: [76, 60, 25, 30],
                    backgroundColor: CALM_CHART_COLORS.primaryAccentMedium,
                    borderRadius: 3,
                    borderWidth: 0,
                    barPercentage: 0.6,
                    categoryPercentage: 0.6
                }]
            },
            options: { ...commonChartOptions,
                scales: { ...commonChartOptions.scales, x: { ...commonChartOptions.scales.x, ticks: { autoSkip: false, maxRotation: 0, minRotation: 0 }}},
                plugins: {...commonChartOptions.plugins, legend: {display: true, position: 'top', labels: {...commonChartOptions.plugins.legend.labels, font: {size: 9}}}}
            }
        });
    }

    const doctorQuestionTopicInput = document.getElementById('doctorQuestionTopic');
    const generateDoctorQuestionsBtn = document.getElementById('generateDoctorQuestionsBtn');
    const doctorQuestionsLoader = document.getElementById('doctorQuestionsLoader');
    const doctorQuestionsOutput = document.getElementById('doctorQuestionsOutput');

    const dietPreferencesInput = document.getElementById('dietPreferences');
    const generateDietIdeasBtn = document.getElementById('generateDietIdeasBtn');
    const dietIdeasLoader = document.getElementById('dietIdeasLoader');
    const dietIdeasOutput = document.getElementById('dietIdeasOutput');

    const apiKey = "AIzaSyCTyBJ5dQZoWWgB14Wjd0l7heigxDRT-qs"; // Replace with your actual API key if needed for testing

    async function callGeminiAPI(prompt, outputElement, loaderElement, buttonElement) {
        loaderElement.classList.remove('hidden');
        outputElement.classList.add('hidden');
        outputElement.textContent = '';
        buttonElement.disabled = true;
        buttonElement.classList.add('opacity-75', 'cursor-not-allowed');

        // Simulate API call delay for demo purposes if not using a real key
        if (apiKey === "YOUR_API_KEY_HERE" || apiKey.includes("AIzaSyCTyBJ5dQZoWWgB14Wjd0l7heigxDRT-qs")) { // Check if it's the placeholder
             console.warn("Using placeholder API key or potentially invalid key for Gemini API call. Simulating response.");
             await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate network delay
             if (buttonElement.id === "generateDoctorQuestionsBtn"){
                outputElement.textContent = `1. Based on my current symptoms related to "${doctorQuestionTopicInput.value || 'this topic'}", what are the primary concerns?
2. What are the potential benefits and risks of the suggested treatment options for me regarding "${doctorQuestionTopicInput.value || 'this topic'}"?
3. How will we monitor the effectiveness of the treatment and what signs should I look out for?
4. Are there any lifestyle adjustments (diet, exercise) you recommend in conjunction with medical treatment for "${doctorQuestionTopicInput.value || 'this topic'}"?
5. What are the long-term expectations or prognosis related to "${doctorQuestionTopicInput.value || 'this topic'}" with the current management plan?`;
             } else if (buttonElement.id === "generateDietIdeasBtn") {
                 outputElement.textContent = `Here are some general ideas based on your input ("${dietPreferencesInput.value || 'general needs'}"):\n
* **Idea 1: Plain, well-cooked oatmeal with ripe banana slices.**
    * *Why it might be suitable:* Oatmeal is often easy to digest, and ripe bananas are generally low in fiber and gentle on the stomach.
* **Idea 2: Baked or steamed white fish (like cod or tilapia) with plain white rice and cooked carrots.**
    * *Why it might be suitable:* White fish is a lean protein, white rice is low in fiber, and well-cooked carrots are usually well-tolerated.
* **Idea 3: Scrambled eggs with a small portion of plain, toasted white bread.**
    * *Why it might be suitable:* Eggs are a good source of protein and are often well-tolerated. Plain white toast is a bland option.\n
IMPORTANT: These are general suggestions and NOT medical or nutritional advice. Always consult with your doctor or a registered dietitian for personalized dietary plans.`;
             } else {
                 outputElement.textContent = 'Simulated response. Configure API key for live data.';
             }
             loaderElement.classList.add('hidden');
             outputElement.classList.remove('hidden');
             buttonElement.disabled = false;
             buttonElement.classList.remove('opacity-75', 'cursor-not-allowed');
             return;
        }


        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API request failed with status ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
            }

            const result = await response.json();

            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                outputElement.textContent = text;
            } else if (result.promptFeedback && result.promptFeedback.blockReason) {
                outputElement.textContent = `The request was blocked. Reason: ${result.promptFeedback.blockReason}. Please try modifying your input.`;
            } else {
                outputElement.textContent = 'Could not retrieve information. The response from the AI was not in the expected format.';
            }
        } catch (error) {
            outputElement.textContent = `An error occurred: ${error.message}. Please try again.`;
            console.error("Gemini API call error:", error);
        } finally {
            loaderElement.classList.add('hidden');
            outputElement.classList.remove('hidden');
            buttonElement.disabled = false;
            buttonElement.classList.remove('opacity-75', 'cursor-not-allowed');
        }
    }

    if (generateDoctorQuestionsBtn) {
        generateDoctorQuestionsBtn.addEventListener('click', () => {
            const topic = doctorQuestionTopicInput.value.trim();
            if (!topic) {
                doctorQuestionsOutput.textContent = 'Please enter a topic.';
                doctorQuestionsOutput.classList.remove('hidden');
                return;
            }
            const prompt = `You are a helpful assistant for individuals with Ulcerative Colitis (UC).
Generate a list of 5-7 concise questions that a patient with Ulcerative Colitis could ask their doctor about the following topic: "${topic}".
The questions should be clear, focused, and aimed at helping the patient better understand their condition, treatment options, potential side effects, or long-term management related to the specified topic.
Format the output as a numbered list.
IMPORTANT: Do NOT provide any medical advice, diagnoses, or treatment recommendations. Only generate questions. Start the response directly with the first question.`;
            callGeminiAPI(prompt, doctorQuestionsOutput, doctorQuestionsLoader, generateDoctorQuestionsBtn);
        });
    }

    if (generateDietIdeasBtn) {
        generateDietIdeasBtn.addEventListener('click', () => {
            const preferences = dietPreferencesInput.value.trim();
            if (!preferences) {
                dietIdeasOutput.textContent = 'Please enter your dietary preferences or needs.';
                dietIdeasOutput.classList.remove('hidden');
                return;
            }
            const prompt = `You are a helpful assistant for individuals with Ulcerative Colitis (UC).
I am looking for general meal or food ideas that are often considered suitable for people with Ulcerative Colitis, keeping in mind the following preferences/restrictions: "${preferences}".
Please provide 3-4 simple meal or snack ideas. For each idea, briefly explain why it might be suitable (e.g., "easy to digest," "low in common irritants").
Format the output clearly, perhaps using bullet points for each idea.
IMPORTANT: Emphasize that these are general suggestions and NOT medical or nutritional advice. State that the user should always consult with their doctor or a registered dietitian for personalized dietary plans. Start the response directly with the meal ideas. Conclude with the disclaimer.`;
            callGeminiAPI(prompt, dietIdeasOutput, dietIdeasLoader, generateDietIdeasBtn);
        });
    }
</script>
</body>
</html>
